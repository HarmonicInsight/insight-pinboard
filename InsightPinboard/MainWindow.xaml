<Window x:Class="InsightPinboard.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Insight Pinboard"
        Width="1200" Height="800"
        MinWidth="800" MinHeight="600"
        Background="{StaticResource BgDark}"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver"
        Closing="Window_Closing"
        KeyDown="Window_KeyDown">

    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.New}"/>
        <KeyBinding Key="S" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.Save}"/>
        <KeyBinding Key="Z" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.Undo}"/>
        <KeyBinding Key="Y" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.Redo}"/>
        <KeyBinding Key="A" Modifiers="Ctrl" Command="{x:Static ApplicationCommands.SelectAll}"/>
        <KeyBinding Key="Delete" Command="{x:Static ApplicationCommands.Delete}"/>
        <KeyBinding Key="OemPlus" Modifiers="Ctrl" Command="{x:Static NavigationCommands.IncreaseZoom}"/>
        <KeyBinding Key="OemMinus" Modifiers="Ctrl" Command="{x:Static NavigationCommands.DecreaseZoom}"/>
        <KeyBinding Key="D0" Modifiers="Ctrl" Command="{x:Static NavigationCommands.Zoom}"/>
    </Window.InputBindings>

    <Window.CommandBindings>
        <CommandBinding Command="{x:Static ApplicationCommands.New}" Executed="NewBoard_Executed"/>
        <CommandBinding Command="{x:Static ApplicationCommands.Save}" Executed="Save_Executed"/>
        <CommandBinding Command="{x:Static ApplicationCommands.Undo}" Executed="Undo_Executed" CanExecute="Undo_CanExecute"/>
        <CommandBinding Command="{x:Static ApplicationCommands.Redo}" Executed="Redo_Executed" CanExecute="Redo_CanExecute"/>
        <CommandBinding Command="{x:Static ApplicationCommands.SelectAll}" Executed="SelectAll_Executed"/>
        <CommandBinding Command="{x:Static ApplicationCommands.Delete}" Executed="Delete_Executed" CanExecute="Delete_CanExecute"/>
        <CommandBinding Command="{x:Static NavigationCommands.IncreaseZoom}" Executed="ZoomIn_Executed"/>
        <CommandBinding Command="{x:Static NavigationCommands.DecreaseZoom}" Executed="ZoomOut_Executed"/>
        <CommandBinding Command="{x:Static NavigationCommands.Zoom}" Executed="ZoomReset_Executed"/>
    </Window.CommandBindings>

    <Grid>
        <Grid.RowDefinitions>
            <!-- Menu -->
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="44"/>
            <!-- Board Tabs -->
            <RowDefinition Height="36"/>
            <!-- Canvas -->
            <RowDefinition Height="*"/>
            <!-- Status Bar -->
            <RowDefinition Height="28"/>
        </Grid.RowDefinitions>

        <!-- ===== MENU BAR ===== -->
        <Menu Grid.Row="0" Background="{StaticResource BgPanel}"
              Foreground="{StaticResource FgSecondary}" FontSize="12">
            <MenuItem Header="ãƒ•ã‚¡ã‚¤ãƒ«(_F)">
                <MenuItem Header="æ–°è¦ãƒœãƒ¼ãƒ‰(_N)" Command="{x:Static ApplicationCommands.New}" InputGestureText="Ctrl+N"/>
                <Separator/>
                <MenuItem Header="ä¿å­˜(_S)" Command="{x:Static ApplicationCommands.Save}" InputGestureText="Ctrl+S"/>
                <Separator/>
                <MenuItem Header="çµ‚äº†(_X)" Click="Exit_Click" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="ç·¨é›†(_E)">
                <MenuItem Header="å…ƒã«æˆ»ã™(_U)" Command="{x:Static ApplicationCommands.Undo}" InputGestureText="Ctrl+Z"/>
                <MenuItem Header="ã‚„ã‚Šç›´ã—(_R)" Command="{x:Static ApplicationCommands.Redo}" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem Header="ã™ã¹ã¦é¸æŠž(_A)" Command="{x:Static ApplicationCommands.SelectAll}" InputGestureText="Ctrl+A"/>
                <MenuItem Header="å‰Šé™¤(_D)" Command="{x:Static ApplicationCommands.Delete}" InputGestureText="Delete"/>
                <Separator/>
                <MenuItem Header="ãƒ¡ãƒ¢è¿½åŠ (_M)" Click="AddNote_Click" InputGestureText="N"/>
                <MenuItem Header="ã‚°ãƒ«ãƒ¼ãƒ—è¿½åŠ (_G)" Click="AddGroup_Click" InputGestureText="G"/>
            </MenuItem>
            <MenuItem Header="è¡¨ç¤º(_V)">
                <MenuItem x:Name="GridSnapMenuItem" Header="ã‚°ãƒªãƒƒãƒ‰ã‚¹ãƒŠãƒƒãƒ—(_G)" IsCheckable="True" IsChecked="True" Click="GridSnapMenu_Click"/>
                <Separator/>
                <MenuItem Header="ãƒ†ãƒ¼ãƒž(_T)">
                    <MenuItem x:Name="ThemeDark" Header="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰" IsCheckable="True" IsChecked="True" Click="ThemeDark_Click"/>
                    <MenuItem x:Name="ThemeLight" Header="ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰" IsCheckable="True" Click="ThemeLight_Click"/>
                    <MenuItem x:Name="ThemeHarmonic" Header="HARMONIC Insight" IsCheckable="True" Click="ThemeHarmonic_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem Header="ã‚ºãƒ¼ãƒ ã‚¤ãƒ³(_I)" Command="{x:Static NavigationCommands.IncreaseZoom}" InputGestureText="Ctrl++"/>
                <MenuItem Header="ã‚ºãƒ¼ãƒ ã‚¢ã‚¦ãƒˆ(_O)" Command="{x:Static NavigationCommands.DecreaseZoom}" InputGestureText="Ctrl+-"/>
                <MenuItem Header="ã‚ºãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ(_R)" Command="{x:Static NavigationCommands.Zoom}" InputGestureText="Ctrl+0"/>
            </MenuItem>
            <MenuItem Header="ãƒ˜ãƒ«ãƒ—(_H)">
                <MenuItem Header="ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±(_A)" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- ===== TOOLBAR ===== -->
        <Border Grid.Row="1" Background="{StaticResource BgPanel}"
                BorderBrush="{StaticResource BorderSubtle}" BorderThickness="0,0,0,1">
            <DockPanel Margin="12,0">
                <TextBlock Text="ðŸ“Œ Insight Pinboard"
                           Foreground="{StaticResource FgPrimary}"
                           FontSize="15" FontWeight="SemiBold"
                           VerticalAlignment="Center" Margin="0,0,20,0"/>

                <Button Content="ðŸ“ ãƒ¡ãƒ¢è¿½åŠ " Click="AddNote_Click"
                        Style="{x:Null}"
                        Background="Transparent" Foreground="{StaticResource FgSecondary}"
                        BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                        Padding="10,4" Margin="4,0" FontSize="12" Cursor="Hand"
                        ToolTip="æ–°ã—ã„ä»˜ç®‹ã‚’è¿½åŠ  (N)"/>

                <Button Content="ðŸ“ ã‚°ãƒ«ãƒ¼ãƒ—è¿½åŠ " Click="AddGroup_Click"
                        Style="{x:Null}"
                        Background="Transparent" Foreground="{StaticResource FgSecondary}"
                        BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                        Padding="10,4" Margin="4,0" FontSize="12" Cursor="Hand"
                        ToolTip="æ–°ã—ã„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è¿½åŠ  (G)"/>

                <Separator Width="1" Margin="8,8" Background="{StaticResource BorderSubtle}"/>

                <CheckBox x:Name="GridSnapCheck" Content="ã‚°ãƒªãƒƒãƒ‰ã‚¹ãƒŠãƒƒãƒ—"
                          Foreground="{StaticResource FgSecondary}" FontSize="11"
                          VerticalAlignment="Center" Margin="4,0"
                          IsChecked="True"/>

                <Separator Width="1" Margin="8,8" Background="{StaticResource BorderSubtle}"/>

                <Button Content="ðŸ’¾ ä¿å­˜" Click="Save_Click"
                        Style="{x:Null}"
                        Background="Transparent" Foreground="{StaticResource FgSecondary}"
                        BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                        Padding="10,4" Margin="4,0" FontSize="12" Cursor="Hand"
                        ToolTip="ä¿å­˜ (Ctrl+S)"/>

                <Separator Width="1" Margin="8,8" Background="{StaticResource BorderSubtle}"/>

                <!-- Undo/Redo -->
                <Button x:Name="UndoBtn" Content="â†©" Click="Undo_Click"
                        Style="{x:Null}"
                        Background="Transparent" Foreground="{StaticResource FgDim}"
                        BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                        Width="28" Height="24" FontSize="14" Cursor="Hand"
                        IsEnabled="False"
                        ToolTip="å…ƒã«æˆ»ã™ (Ctrl+Z)"/>
                <Button x:Name="RedoBtn" Content="â†ª" Click="Redo_Click"
                        Style="{x:Null}"
                        Background="Transparent" Foreground="{StaticResource FgDim}"
                        BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                        Width="28" Height="24" FontSize="14" Cursor="Hand" Margin="2,0,0,0"
                        IsEnabled="False"
                        ToolTip="ã‚„ã‚Šç›´ã— (Ctrl+Y)"/>

                <Separator Width="1" Margin="8,8" Background="{StaticResource BorderSubtle}"/>

                <!-- Search Box -->
                <Border Background="#15ffffff" CornerRadius="4" Padding="0" Margin="4,0"
                        BorderBrush="{StaticResource BorderSubtle}" BorderThickness="1">
                    <Grid Width="180">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="ðŸ”" FontSize="12" VerticalAlignment="Center"
                                   Margin="8,0,4,0" Foreground="{StaticResource FgDim}"/>
                        <TextBox x:Name="SearchBox" Grid.Column="1"
                                 Background="Transparent" BorderThickness="0"
                                 Foreground="{StaticResource FgPrimary}" FontSize="12"
                                 VerticalAlignment="Center" Padding="4,4"
                                 TextChanged="SearchBox_TextChanged"
                                 KeyDown="SearchBox_KeyDown"
                                 ToolTip="æ¤œç´¢ (Ctrl+F)"/>
                        <TextBlock x:Name="SearchPlaceholder" Grid.Column="1"
                                   Text="æ¤œç´¢..." FontSize="12"
                                   Foreground="{StaticResource FgDim}"
                                   VerticalAlignment="Center" Margin="4,0"
                                   IsHitTestVisible="False"
                                   Visibility="Visible"/>
                        <Button x:Name="SearchClearBtn" Grid.Column="2" Content="âœ•"
                                Style="{x:Null}"
                                Background="Transparent" Foreground="{StaticResource FgDim}"
                                BorderThickness="0" FontSize="10" Cursor="Hand"
                                Width="20" Height="20" Margin="0,0,4,0"
                                Click="SearchClear_Click"
                                Visibility="Collapsed"
                                ToolTip="ã‚¯ãƒªã‚¢ (Esc)"/>
                    </Grid>
                </Border>

                <!-- Search Results Info -->
                <TextBlock x:Name="SearchResultText" Text=""
                           Foreground="{StaticResource FgDim}" FontSize="10"
                           VerticalAlignment="Center" Margin="8,0,0,0"/>

                <!-- Right side - Zoom controls -->
                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal"
                            VerticalAlignment="Center" HorizontalAlignment="Right">
                    <Button Content="âˆ’" Click="ZoomOut_Click"
                            Style="{x:Null}"
                            Background="Transparent" Foreground="{StaticResource FgSecondary}"
                            BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                            Width="28" Height="24" FontSize="14" Cursor="Hand"
                            ToolTip="ç¸®å° (Ctrl+-)"/>
                    <TextBlock x:Name="ZoomLevelText" Text="100%"
                               Foreground="{StaticResource FgDim}" FontSize="11"
                               VerticalAlignment="Center" Width="40" TextAlignment="Center"/>
                    <Button Content="ï¼‹" Click="ZoomIn_Click"
                            Style="{x:Null}"
                            Background="Transparent" Foreground="{StaticResource FgSecondary}"
                            BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                            Width="28" Height="24" FontSize="14" Cursor="Hand"
                            ToolTip="æ‹¡å¤§ (Ctrl++)"/>
                    <Button Content="âŸ²" Click="ZoomReset_Click"
                            Style="{x:Null}"
                            Background="Transparent" Foreground="{StaticResource FgSecondary}"
                            BorderThickness="1" BorderBrush="{StaticResource BorderSubtle}"
                            Width="28" Height="24" FontSize="12" Cursor="Hand" Margin="4,0,0,0"
                            ToolTip="ãƒªã‚»ãƒƒãƒˆ (Ctrl+0)"/>
                </StackPanel>

                <!-- Selection info -->
                <TextBlock x:Name="SelectionInfoText" Text=""
                           Foreground="{StaticResource AccentBlue}" FontSize="11"
                           VerticalAlignment="Center" Margin="8,0"
                           FontWeight="Medium"/>
            </DockPanel>
        </Border>

        <!-- ===== BOARD TABS ===== -->
        <Border Grid.Row="2" Background="{StaticResource BgPanel}"
                BorderBrush="{StaticResource BorderSubtle}" BorderThickness="0,0,0,1">
            <DockPanel>
                <Button DockPanel.Dock="Right" Content=" ï¼‹ " Click="AddBoard_Click"
                        Style="{x:Null}"
                        Background="Transparent" Foreground="{StaticResource FgDim}"
                        BorderThickness="0" FontSize="14" Cursor="Hand"
                        Padding="8,0" Margin="4,0"
                        ToolTip="æ–°ã—ã„ãƒœãƒ¼ãƒ‰ã‚’è¿½åŠ "/>

                <ItemsControl x:Name="BoardTabs" Margin="12,0,0,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </DockPanel>
        </Border>

        <!-- ===== CANVAS with Zoom/Pan ===== -->
        <Border Grid.Row="3" ClipToBounds="True" Background="{StaticResource BgDark}"
                MouseWheel="Canvas_MouseWheel"
                MouseDown="Canvas_MouseDown"
                MouseMove="Canvas_PanMove"
                MouseUp="Canvas_MouseUp">

            <Canvas x:Name="PinCanvas"
                    RenderTransformOrigin="0,0"
                    MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                    MouseRightButtonDown="Canvas_MouseRightButtonDown">

                <Canvas.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform x:Name="CanvasScale" ScaleX="1" ScaleY="1"/>
                        <TranslateTransform x:Name="CanvasTranslate" X="0" Y="0"/>
                    </TransformGroup>
                </Canvas.RenderTransform>

                <!-- Grid pattern (optional visual) -->
                <Canvas.Background>
                    <DrawingBrush TileMode="Tile" Viewport="0,0,40,40" ViewportUnits="Absolute">
                        <DrawingBrush.Drawing>
                            <GeometryDrawing>
                                <GeometryDrawing.Pen>
                                    <Pen Brush="#0Affffff" Thickness="1"/>
                                </GeometryDrawing.Pen>
                                <GeometryDrawing.Geometry>
                                    <GeometryGroup>
                                        <LineGeometry StartPoint="0,0" EndPoint="40,0"/>
                                        <LineGeometry StartPoint="0,0" EndPoint="0,40"/>
                                    </GeometryGroup>
                                </GeometryDrawing.Geometry>
                            </GeometryDrawing>
                        </DrawingBrush.Drawing>
                    </DrawingBrush>
                </Canvas.Background>

                <!-- Drop hint when empty -->
                <TextBlock x:Name="EmptyHint"
                           Text="ðŸ“Œ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ãƒ»URLã‚’ã“ã“ã«ãƒ‰ãƒ­ãƒƒãƒ—"
                           Foreground="{StaticResource FgDim}" FontSize="18"
                           Canvas.Left="0" Canvas.Top="0"
                           Visibility="Visible"/>

                <!-- Selection Rectangle -->
                <Rectangle x:Name="SelectionRect"
                           Stroke="{StaticResource AccentBlue}"
                           StrokeThickness="1"
                           StrokeDashArray="4 2"
                           Fill="#2060a5fa"
                           Visibility="Collapsed"/>
            </Canvas>
        </Border>

        <!-- ===== STATUS BAR ===== -->
        <Border Grid.Row="4" Background="{StaticResource BgPanel}"
                BorderBrush="{StaticResource BorderSubtle}" BorderThickness="0,1,0,0">
            <DockPanel Margin="12,0">
                <TextBlock x:Name="StatusText" Text="æº–å‚™å®Œäº†"
                           Foreground="{StaticResource FgDim}" FontSize="10"
                           VerticalAlignment="Center"/>

                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal"
                            VerticalAlignment="Center">
                    <TextBlock x:Name="MousePosText" Text="X: 0  Y: 0"
                               Foreground="{StaticResource FgDim}" FontSize="10"
                               Margin="0,0,16,0"/>
                    <TextBlock x:Name="ItemCountText" Text=""
                               Foreground="{StaticResource FgDim}" FontSize="10"/>
                </StackPanel>
            </DockPanel>
        </Border>
    </Grid>
</Window>
